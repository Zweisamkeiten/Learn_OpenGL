# 投光物

目前所使用的光照来自于空间中的一点

虽然它已经有不错的效果了，但现实世界中有很多种类的光照。每种的表现都不同，将光投射到(cast)到物体的光源叫做投光物(Light Castere)

继续学习几种不同类型的投光物 模拟不同的光源进一步丰富场景

首先讨论定向光(Directional Light) 然后是点光源(Point Light).

最后讨论聚光(Spotlight)

## 平行光

当一个光源处于很远的地方时，来自光源的每条光线都会近似于互相平行。

不论物体或者观察者的位置，所有的光近似于来自同一个方向。

当使用一个假设光源处于无线远处的模型时，它就被称为定向光。它所有的光线有相同的方向，与光源的位置是没有关系的。

定向光的一个例子是太阳。太阳的距离在光线计算中视为无限远。所以来自太阳的所有光线将模拟为平行光线

因为所有光线都是平行的，所以物体与光源的相对位置是不重要的。
因为对场景中每一个物体光的方向都是一致的。
因此场景中每个物体的光照计算是类似的。

定义一个光线方向向量，而不是位置向量来模拟一个定向光。着色器的计算基本保持不变。直接使用光的dircetion向量，而不是通过position来计算lightDir

---
如果将光的位置和位置向量定义为vec4时，需要将w分量 设置为1.0

这样变换和投影才能正确应用

然而当定义一个方向向量为vec4时，不想让位移产生效果 它仅仅代表方向，因此将w分量设置为0.0

方向向量可以这样来表示vec4(0.2f, 1.0f, 0.3f, 0.0f)

这种区别可以作为快速检测光照类型的工具。
通过检测w分量是否等于1.0,来检测它是否是光的位置向量。w分量等于0.0，则它是光的方向向量

```cpp
if(lightVector.w == 0.0)
    // 执行定向光照计算
else if(lightVector.w == 1.0)
    // 根据光源的位置做光照计算(与上一节相同)
```

## 点光源

定向光源对于照亮整个场景的全局光源是非常明显的， 但是除了定向光以外，也需要一些分散在场景中的点光源(Poing Light)

点光源是处于世界中某个位置的光源， 它会朝着所有的方向发光，但是光线会随着距离逐渐衰减

作为投光物的灯泡和火把都是点光源

之前一直在使用一个简化的点光源，在给定的位置有一个光源，会从光源的位置开始朝着所有方向散射光线。但是，这定义的光源是永远 不会衰减的光线，使光源亮度非常的强。 大部分的3D模拟中，希望模拟的光源仅照亮光源附近的区域而不是整个场景

## 衰减

随着光线的传播距离的增长 逐渐削减光照强度叫做衰减 随距离减少光强度的一种方式是使用一个线性方程。

这个方程能够随着距离的增长线性地减少光的的强度 从而让远处的物体更暗。

然而这样的的线性方程通常会看起来比较假。

现实世界中，灯在近处通常会很亮，但随着距离的增加光源的亮度一开始会下降非常快，但在远处时剩余的光强度会下降的非常缓慢了。

因此需要一个不同的公式来减少光的强度

这个公式根据片段距离光源的距离计算了衰减值 之后将它乘以光的强度向量。

Fatt=1.0/ (1.0Kc+Kl∗d+Kq∗d2)

此处的`d`代表片段距离光源的距离。
为了计算衰减值，定义3个可配置项 常数项Kc 一次项Kl 和二次项Kq

- 常数项通常保持为1.0，主要作用为保证分母永远不会比1小，否则在某些距离上，他反而会增加强度
- 一次项会与距离值相乘，以线性的方式减少强度
- 二次项会与距离的平方相乘，让光源以二次递减的方式减少强度。 二次项在距离比较小的时候影响会比一次项小很多，但当距离值比较大时，就会比一次项更大了。

由于二次项的存在，光线会在大部分时候以线性的方式衰退，直到距离变得足够大，让二次项超过一次项，光的强度会以更快的速度下降。

这样的结果是，光在近距离时亮度很高，但随着距离变远亮度迅速降低，最后会以更慢的速度减少亮度

### 选择正确的可配置项值

正确的设置可配置项的值取决于很多因素:环境，希望光覆盖的距离、光的类型等

可从[Ogre3D wiki](http://www.ogre3d.org/tikiwiki/tiki-index.php?page=-Point+Light+Attenuation)中查表

常数项Kc在所有情况下都是1.0 一次项Kl为了覆盖更远的距离通常都很小， 二次项Kq甚至更小

### 实现衰减


## 聚光

据光是位于环境中某个位置的光源 它只朝着一个特定的方向
